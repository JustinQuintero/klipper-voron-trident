#####################################################################
# 	Include configs
#####################################################################
[include include.cfg]

# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design Trident 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

## *** THINGS TO CHANGE/CHECK: ***
## MCU paths                            [mcu] section
## Thermistor types                     [extruder] and [heater_bed] sections
## Leadscrew Rotation Distance          [stepper_z], [stepper_z1], [stepper_z2]
## Z Endstop Switch location            [safe_z_home] section
## Z Endstop Switch offset for Z0       [stepper_z] section
## PID tune                             [extruder] and [heater_bed] sections
## Probe pin                            [probe] section
## Fine tune E steps                    [extruder] section

#####################################################################
# 	Controller
#####################################################################

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_1B0035000A51373330333137-if00
restart_method: command

#####################################################################
# 	Kinematics
#####################################################################

[printer]
kinematics: corexy
max_velocity: 450
max_accel: 4000
max_accel_to_decel: 2000
max_z_velocity: 30
max_z_accel: 350
square_corner_velocity: 8.0

#####################################################################
# 	Miscellaneous
#####################################################################

[display_status]
[exclude_object]
[firmware_retraction]
[idle_timeout]
timeout: 1800
[pause_resume]
[respond]
[save_variables]
filename: ~/klipper_config/macros/calibrate/save_variables.cfg
[virtual_sdcard]
path: ~/printer_data/gcodes

#####################################################################
# 	Extruder
#####################################################################

#   Connected to MOTOR_6
#   Heater - HE0
#   Thermistor - T0
[extruder]
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
##  rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100
rotation_distance: 22.833896
##  Use 50:10 for Stealthburner/Clockwork2 (BMG Gear Ratio)
gear_ratio: 50:10               #BMG Gear Ratio
microsteps: 32
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: PA2
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 270
max_power: 1.0
min_extrude_temp: 170
control: pid
pid_Kp: 25.230
pid_Ki: 1.246
pid_Kd: 127.725
pressure_advance: 0.00
pressure_advance_smooth_time: 0.040
max_extrude_only_distance: 100.0
max_extrude_cross_section: 5

##  E0 on MOTOR6
[tmc2209 extruder]
uart_pin: PE1
interpolate: false
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Heater Bed
#####################################################################

[heater_bed]
##  SSR Pin - HE1
##  Thermistor - TB
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.83
min_temp: 0
max_temp: 120
control: pid
pid_Kp: 35.381
pid_Ki: 0.959
pid_Kd: 326.386

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe]
#*# z_offset = -0.625
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.001719, -0.005000, -0.009063, -0.013281, -0.039844, -0.020156, 0.003281, 0.012812, 0.039375
#*# 	  0.035781, 0.020937, 0.045781, 0.014687, 0.008906, 0.015000, -0.000156, 0.017656, 0.052187
#*# 	  0.030156, 0.047656, 0.002031, 0.009219, -0.006719, 0.041094, 0.026406, 0.077187, 0.037500
#*# 	  -0.002813, 0.013437, 0.039531, 0.015937, 0.026875, 0.018750, 0.031250, 0.024844, 0.032969
#*# 	  0.025937, 0.025781, 0.010781, 0.004531, -0.005000, 0.017500, -0.002969, 0.038750, 0.049219
#*# 	  0.013594, -0.006875, 0.004062, -0.022188, -0.006250, -0.008906, 0.008594, -0.013594, 0.024531
#*# 	  -0.047500, -0.031719, -0.019688, -0.016719, -0.005469, 0.011719, -0.010781, -0.003281, 0.007656
#*# 	  -0.018281, -0.032813, -0.010000, -0.007969, -0.012031, -0.007813, 0.009375, 0.000312, 0.036250
#*# 	  -0.005781, 0.027500, 0.028437, 0.023437, 0.015781, 0.020312, 0.025469, 0.019687, 0.057500
#*# tension = 0.2
#*# min_x = 30.53
#*# algo = bicubic
#*# y_count = 9
#*# mesh_y_pps = 2
#*# min_y = 32.28
#*# x_count = 9
#*# max_y = 270.76
#*# mesh_x_pps = 2
#*# max_x = 270.13
